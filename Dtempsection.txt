        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
          console.debug('Cannot process input - WebSocket not ready')
          return
        }
        
        // 处理特殊按键
        switch (data) {
          case '\r':
          case '\n': // 回车键
            console.debug('Enter key pressed, processing command')
            // 保存命令到历史记录（如果非空）
            if (this.inputBuffer.trim()) {
              // 避免重复命令
              if (this.commandHistory[this.commandHistory.length - 1] !== this.inputBuffer) {
                this.commandHistory.push(this.inputBuffer)
                // 限制历史记录长度
                if (this.commandHistory.length > 50) {
                  this.commandHistory.shift()
                }
              }
            }
            
            // 发送完整的命令行，包含当前工作目录信息
            console.debug('Sending command to server:', this.inputBuffer)
            this.ws.send(JSON.stringify({
              type: 'command',
              data: {
                command: this.inputBuffer + '\n',
                // 确保总是发送当前路径，如果未定义则默认为~
                currentPath: this.currentWorkingDirectory || '~'
              }
            }))
            console.debug('Command sent to server with current path:', this.currentWorkingDirectory)
            
            // 重置状态
            this.inputBuffer = ''
            this.historyIndex = -1
            this.currentInput = ''
            
            this.terminal.write('\r\n')
            break
            
          case '\x7f':
          case '\b': // 退格键
            console.debug('Backspace key pressed')
